# 02318:TOYS

binary search, http://cs101.openjudge.cn/practice/02318/

Calculate the number of toys that land in each bin of a partitioned toy box. Mom and dad have a problem - their child John never puts his toys away when he is finished playing with them. They gave John a rectangular box to put his toys in, but John is rebellious and obeys his parents by simply throwing his toys into the box. All the toys get mixed up, and it is impossible for John to find his favorite toys. John's parents came up with the following idea. They put cardboard partitions into the box. Even if John keeps throwing his toys into the box, at least toys that get thrown into different bins stay separated. The following diagram shows a top view of an example toy box. ![img](http://media.openjudge.cn/images/g1320/2318_1.jpg) For this problem, you are asked to determine how many toys fall into each partition as John throws them into the toy box.

输入

The input file contains one or more problems(< 15). The first line of a problem consists of six integers, n m x1 y1 x2 y2. The number of cardboard partitions is n (0 < n <= 5000) and the number of toys is m (0 < m <= 5000). The coordinates of the upper-left corner and the lower-right corner of the box are (x1,y1) and (x2,y2), respectively. The following n lines contain two integers per line, Ui Li, indicating that the ends of the i-th cardboard partition is at the coordinates (Ui,y1) and (Li,y2). You may assume that the cardboard partitions do not intersect each other and that they are specified in sorted order from left to right. The next m lines contain two integers per line, Xj Yj specifying where the j-th toy has landed in the box. The order of the toy locations is random. You may assume that no toy will land exactly on a cardboard partition or outside the boundary of the box. The input is terminated by a line consisting of a single 0.

输出

The output for each problem will be one line for each separate bin in the toy box. For each bin, print its bin number, followed by a colon and one space, followed by the number of toys thrown into that bin. Bins are numbered from 0 (the leftmost bin) to n (the rightmost bin). Separate the output of different problems by a single blank line.

样例输入

```
5 6 0 10 60 0
3 1
4 3
6 8
10 10
15 30
1 5
2 1
2 8
5 5
40 10
7 9
4 10 0 10 100 0
20 20
40 40
60 60
80 80
 5 10
15 10
25 10
35 10
45 10
55 10
65 10
75 10
85 10
95 10
0
```

样例输出

```
0: 2
1: 1
2: 1
3: 1
4: 0
5: 1

0: 2
1: 2
2: 2
3: 2
4: 2
```

提示

As the example illustrates, toys that fall on the boundary of the box are "in" the box.

来源

Rocky Mountain 2003





思路：使用几何直线插值 + 二分查找

```python
def compute_bin(toy_x, toy_y, y1, y2, partitions):
    # 二分查找找到 toy 落在哪个 bin 中
    left, right = 0, len(partitions)
    while left < right:
        mid = (left + right) // 2
        u, l = partitions[mid]
        # 计算直线 (u,y1) 到 (l,y2) 在 toy_y 高度的 x 坐标
        part_x = u + (l - u) * (y1 - toy_y) / (y1 - y2)
        if toy_x < part_x:
            right = mid
        else:
            left = mid + 1
    return left

def main():
    import sys
    input_lines = sys.stdin.read().splitlines()
    idx = 0
    output = []
    
    while idx < len(input_lines):
        line = input_lines[idx].strip()
        idx += 1
        if line == '0':
            break
        if not line:
            continue
        n, m, x1, y1, x2, y2 = map(int, line.split())
        partitions = []
        for _ in range(n):
            u, l = map(int, input_lines[idx].split())
            partitions.append((u, l))
            idx += 1
        toys = []
        for _ in range(m):
            x, y = map(int, input_lines[idx].split())
            toys.append((x, y))
            idx += 1
        
        bin_counts = [0] * (n + 1)
        for tx, ty in toys:
            bin_index = compute_bin(tx, ty, y1, y2, partitions)
            bin_counts[bin_index] += 1
        
        for i, count in enumerate(bin_counts):
            output.append(f"{i}: {count}")
        output.append("")  # blank line between problems

    print("\n".join(output).strip())  # strip the last blank line

if __name__ == "__main__":
    main()
```

✅ 特点

- 使用几何公式计算每个 partition 的插值点（玩具落点对应的分隔板x位置）。
- 用二分查找高效查找所属的 bin（隔间）。
- 完整处理多个测试用例，以空行分隔输出。


