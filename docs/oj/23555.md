# 23555: èŠ‚çœå­˜å‚¨çš„çŸ©é˜µä¹˜æ³•

matrices, http://cs101.openjudge.cn/practice/23555/

ç”±äºçŸ©é˜µå­˜å‚¨éå¸¸è€—è´¹ç©ºé—´ï¼Œä¸€ä¸ªé•¿åº¦nå®½åº¦mçš„çŸ©é˜µéœ€è¦èŠ±è´¹n*mçš„å­˜å‚¨ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©ç”¨å¦ä¸€ç§èŠ‚çœç©ºé—´çš„æ–¹æ³•è¡¨ç¤ºçŸ©é˜µã€‚ä¸€ä¸ªçŸ©é˜µXå¯ä»¥è¡¨ç¤ºä¸ºä¸‰å…ƒç»„çš„åºåˆ—ï¼Œæ¯ä¸ªä¸‰å…ƒç»„ä»£è¡¨ï¼ˆè¡Œå·ï¼Œåˆ—å·ï¼Œå…ƒç´ å€¼ï¼‰ï¼Œå¦‚æœå…ƒç´ å€¼æ˜¯0åˆ™æˆ‘ä»¬ä¸å­˜å‚¨è¿™ä¸ªä¸‰å…ƒç»„ï¼Œè¿™æ ·å¯¹äº0å¾ˆå¤šçš„å¤§å‹çŸ©é˜µï¼Œæˆ‘ä»¬èŠ‚çœäº†å¾ˆå¤šå­˜å‚¨ç©ºé—´ã€‚ç°åœ¨æˆ‘ä»¬æœ‰ä¸¤ä¸ªç”¨è¿™ç§æ–¹å¼è¡¨ç¤ºçš„çŸ©é˜µXå’ŒYï¼Œæˆ‘ä»¬æƒ³è¦è®¡ç®—è¿™ä¸¤ä¸ªçŸ©é˜µçš„ä¹˜ç§¯ï¼Œå¹¶ä¸”ä¹Ÿç”¨ä¸‰å…ƒç»„å½¢å¼è¡¨è¾¾ï¼Œè¯¥å¦‚ä½•å®Œæˆå‘¢ã€‚

å¦‚æœä¸çŸ¥é“çŸ©é˜µå¦‚ä½•ç›¸ä¹˜ï¼Œå¯ä»¥å‚è€ƒï¼šhttp://cs101.openjudge.cn/practice/18161

**è¾“å…¥**

è¾“å…¥ç¬¬ä¸€è¡Œæ˜¯ä¸‰ä¸ªæ•´æ•°nï¼Œm1, m2ï¼Œä¸¤ä¸ªçŸ©é˜µXï¼ŒYçš„ç»´åº¦éƒ½æ˜¯n*nï¼Œm1æ˜¯çŸ©é˜µXä¸­çš„é0å…ƒç´ æ•°ï¼Œm2æ˜¯çŸ©é˜µYä¸­çš„é0å…ƒç´ æ•°ã€‚
ä¹‹åæ˜¯m1è¡Œï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ï¼ˆè¡Œå·ï¼Œåˆ—å·ï¼Œå…ƒç´ å€¼ï¼‰ï¼Œä»£è¡¨XçŸ©é˜µçš„å…ƒç´ å€¼ï¼Œæ³¨æ„è¡Œåˆ—ç¼–å·éƒ½ä»0å¼€å§‹ã€‚
ä¹‹åæ˜¯m2è¡Œï¼Œæ¯è¡Œæ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ï¼ˆè¡Œå·ï¼Œåˆ—å·ï¼Œå…ƒç´ å€¼ï¼‰ï¼Œä»£è¡¨YçŸ©é˜µçš„å…ƒç´ å€¼ï¼Œæ³¨æ„è¡Œåˆ—ç¼–å·éƒ½ä»0å¼€å§‹ã€‚

**è¾“å‡º**

è¾“å‡ºæ˜¯m3è¡Œï¼Œä»£è¡¨Xå’ŒYä¸¤ä¸ªçŸ©é˜µä¹˜ç§¯ä¸­çš„é0å…ƒç´ çš„æ•°ç›®ï¼ŒæŒ‰ç…§å…ˆè¡Œå·ååˆ—å·çš„æ–¹å¼é€’å¢æ’åºã€‚
æ¯è¡Œä»ç„¶æ˜¯å‰è¿°çš„ä¸‰å…ƒç»„å½¢å¼ã€‚

æ ·ä¾‹è¾“å…¥

```
Sample Input1:
3 3 2
0 0 1
1 0 -1
1 2 3
0 0 7
2 2 1

Sample Output1:
0 0 7
1 0 -7
1 2 3

è§£é‡Šï¼š
A = [
  [ 1, 0, 0],
  [-1, 0, 3],
  [0, 0, 0]
]

B = [
  [ 7, 0, 0 ],
  [ 0, 0, 0 ],
  [ 0, 0, 1 ]
]

A*B = [
[7,0,0],
[-7,0,3],
[0,0,0]]
```

æ ·ä¾‹è¾“å‡º

```
Sample Input2:
2 2 4
0 0 1
1 1 1
0 0 2
0 1 3
1 0 4
1 1 5

Sample Output2:
0 0 2
0 1 3
1 0 4
1 1 5

è§£é‡Šï¼š
A = [
[1,0],
[0,1]
]

B = [
[2,3],
[4,5]
]

A*B = [
[2,3],
[4,5]
]
```

æç¤ºï¼štags: implementation,matrices

æ¥æºï¼š2021fall-cs101, hy



**é—®é¢˜ç†è§£**

çŸ©é˜µ Xã€Y æ˜¯ç¨€ç–çŸ©é˜µï¼ˆåªå­˜å‚¨éé›¶é¡¹ï¼‰ï¼Œæˆ‘ä»¬è¦è®¡ç®—çŸ©é˜µä¹˜æ³• `Z = X * Y`ï¼Œå¹¶ä»¥ç›¸åŒç¨€ç–å½¢å¼è¾“å‡ºã€‚

æ™®é€šçŸ©é˜µä¹˜æ³•å…¬å¼ï¼š
$$
Z[i][j] = \sum_k X[i][k] * Y[k][j]
$$
è¾“å…¥ä¸­ï¼š

- `n` æ˜¯çŸ©é˜µçš„å¤§å°ï¼ˆnÃ—nï¼‰
- `m1` æ˜¯ X çš„éé›¶é¡¹æ•°
- `m2` æ˜¯ Y çš„éé›¶é¡¹æ•°
  æ¯ä¸ªä¸‰å…ƒç»„ `(r, c, v)` è¡¨ç¤ºï¼š`çŸ©é˜µ[r][c] = v`

è¾“å‡ºè¦ï¼š

- åªè¾“å‡ºéé›¶é¡¹
- å…ˆæŒ‰è¡Œå·å‡åºã€å†æŒ‰åˆ—å·å‡åºæ’åº



è¦æ±‚ç”¨èŠ‚çœå†…å­˜çš„æ–¹å¼å®ç°ï¼Œä¸èƒ½è¿˜åŸçŸ©é˜µçš„æ–¹å¼å®ç°ã€‚

æ€è·¯ï¼šå¯¹ç¬¬ä¸€ä¸ªçŸ©é˜µé‡Œçš„æŸå…ƒç´ å’Œç¬¬äºŒä¸ªçŸ©é˜µé‡Œçš„æŸå…ƒç´ ï¼Œè‹¥è¿™äºŒè€…èƒ½ç›¸ä¹˜ï¼Œç»“æœçŸ©é˜µçš„å¯¹åº”å…ƒç´ åŠ ä¸Šè¿™äºŒè€…çš„ä¹˜ç§¯ï¼Œç”¨å­—å…¸è®°å½•ï¼Œæœ€åè¾“å‡ºæ‰€æœ‰å€¼ä¸ä¸º0çš„å…ƒç´ 

```python
from collections import defaultdict
n,m1,m2=map(int,input().split())
d=defaultdict(int)
l1,l2=[],[]
for i in range(m1):
    l1.append(tuple(map(int,input().split())))
for i in range(m2):
    l2.append(tuple(map(int,input().split())))
for i in range(m1):
    for j in range(m2):
        if l1[i][1]==l2[j][0]:
            d[(l1[i][0],l2[j][1])]+=l1[i][2]*l2[j][2]
for i in range(n):
    for j in range(n):
        if d[(i,j)]:
            print(i,j,d[(i,j)])
```



æ€è·¯ï¼šæŒæ¡å¥½çŸ©é˜µè¿ç®—æ³•åˆ™ï¼ŒæŠŠç´¢å¼•ææ¸…æ¥šå°±è¡Œã€‚

```python
n,m1,m2 = map(int,input().split())

matrix1 = {}
matrix2 = {}

for _ in range(m1):
    r,c,v = map(int,input().split())
    matrix1[(r,c)] = v
for _ in range(m2):
    r,c,v = map(int,input().split())
    matrix2[(r,c)] = v

result = {}

for (r1,c1),v1 in matrix1.items():
    for (r2,c2),v2 in matrix2.items():
        if c1 == r2:
            if (r1,c2) in result:
                result[(r1,c2)] += v1 * v2
            else:
                result[(r1,c2)] = v1 * v2

for (r,c),v in sorted(result.items()):
    print(r,c,v)
```



```python
# èŠ‚çœå­˜å‚¨çš„çŸ©é˜µä¹˜æ³•
# é‡‡ç”¨å­—å…¸ï¼Œå¯¹æ¯ä¸€ä¸ªçŸ©é˜µï¼Œé”®(i,j)å¯¹åº”å€¼X(i,j)æˆ–è€…Y(i,j)ï¼Œ 
# éå†æ‰€æœ‰çš„X(i,k)ï¼Œå¯»æ‰¾Y(k,j)ï¼Œä¹˜ç§¯ç´¯å’Œå¾—åˆ°C(i,j)
n,m1,m2 = map(int,input().split())
X = {}
for _ in range (m1):
    i,j,value = map(int,input().split())
    X[(i,j)] = value
Y = {}
for _ in range (m2):
    i,j,value = map(int,input().split())
    Y[(i,j)] = value
C = {}
'''
è¿™é‡Œçš„.items()ç”¨äºè¿”å›å­—å…¸ä¸­æ‰€æœ‰é”®å€¼å¯¹çš„è§†å›¾å¯¹è±¡ï¼Œè§†å›¾å¯¹
è±¡åŒ…å«å­—å…¸ä¸­çš„é”®å€¼å¯¹ï¼Œå¹¶ä»¥ (key, value) çš„å½¢å¼ç»„æˆ
ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡,å¯ä»¥åœ¨å¾ªç¯ä¸­æ–¹ä¾¿åœ°åŒæ—¶è·å–é”®å’Œå€¼ã€‚åœ¨éœ€è¦å¯¹æ¯”æˆ–æ›´æ–°ä¸¤ä¸ªå­—å…¸çš„é”®å€¼å¯¹æ—¶ï¼Œ
.items() å¯ä»¥ç›´æ¥è·å–å­—å…¸çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ–¹ä¾¿æŸ¥æ‰¾æˆ–ä¿®æ”¹ã€‚
'''
for (i,k1),value1 in X.items():
    for (k2,j),value2 in Y.items():
        if k1 == k2:
            if (i,j) not in C:
                C[(i,j)] = 0
            C[(i,j)] += value1*value2
'''
é¢˜ç›®è¦æ±‚æŒ‰ç…§è¡Œåˆ—å‡åºè¾“å‡º
å¯¹å­—å…¸ï¼Œsorted()é»˜è®¤æŒ‰ç…§å­—å…¸çš„é”®æ’åºï¼Œå¦‚æœé”®æ˜¯é«˜ç»´çš„ï¼Œ
ä»ç¬¬ä¸€ä½å¼€å§‹ä¼˜å…ˆæ’åºï¼Œç¬¬ä¸€ä½ç›¸åŒï¼ŒæŒ‰ç…§ç¬¬äºŒä½æ’åºï¼Œä»¥æ­¤ç±»æ¨
'''
for (i,j),value in sorted(C.items()):
    print(i,j,value)
```





> 18161:çŸ©é˜µè¿ç®—ã€‚http://cs101.openjudge.cn/practice/18161
>
> çŸ©é˜µä¹˜æ³•è¿ç®—å¿…é¡»è¦å‰ä¸€ä¸ªçŸ©é˜µçš„åˆ—æ•°ä¸åä¸€ä¸ªçŸ©é˜µçš„è¡Œæ•°ç›¸åŒï¼Œ
> å¦‚mè¡Œnåˆ—çš„çŸ©é˜µAä¸nè¡Œpåˆ—çš„çŸ©é˜µBç›¸ä¹˜ï¼Œå¯ä»¥å¾—åˆ°mè¡Œpåˆ—çš„çŸ©é˜µCï¼Œ
> çŸ©é˜µCçš„æ¯ä¸ªå…ƒç´ éƒ½ç”±Açš„å¯¹åº”è¡Œä¸­çš„å…ƒç´ ä¸Bçš„å¯¹åº”åˆ—ä¸­çš„å…ƒç´ ä¸€ä¸€ç›¸ä¹˜å¹¶æ±‚å’Œå¾—åˆ°ï¼Œ
> å³`C[i][j] = A[i][0]*B[0][j] + A[i][1]*B[1][j] + â€¦â€¦ +A[i][n-1]*B[n-1][j]`
>
> (`C[i][j]`è¡¨ç¤ºCçŸ©é˜µä¸­ç¬¬iè¡Œç¬¬jåˆ—å…ƒç´ )ã€‚
>
> å³ï¼Œ$c_{ij}=\Sigma a_{ik}b_{kj}$

è¾“å…¥æ”¾åˆ°çŸ©é˜µé‡Œé¢å°±å¥½äº†ï¼Œåœ¨è®¡ç®—ä¹˜æ³•ä¹‹åä¸€æ—¦æœ‰å€¼ä¸æ˜¯0å°±å¯ä»¥åœ¨éå†ä¸­ç›´æ¥æŠŠä½ç½®å’Œå€¼è¾“å‡ºã€‚

```python
# æ±¤ä¼Ÿæ°ï¼Œ24ä¿¡æ¯ç®¡ç†ç³»
n, m1, m2 = map(int, input().split())
a = [[0] * n for _ in range(n)]
b = [[0] * n for _ in range(n)]
for _ in range(m1):
    x, y, v = map(int, input().split())
    a[x][y] = v
for _ in range(m2):
    x, y, v = map(int, input().split())
    b[x][y] = v
c = [[0] * n for _ in range(n)]
for i in range(n):
    for j in range(n):
        c[i][j] = sum(a[i][k] * b[k][j] for k in range(n))
        if c[i][j] != 0:
            print(i, j, c[i][j])
```



æ€è·¯ï¼šå°†Aæ•°ç»„ä»¥ç¬¬äºŒåæ ‡ä¸ºç´¢å¼•ï¼ŒBæ•°ç»„ä»¥ç¬¬ä¸€åæ ‡ä¸ºç´¢å¼•ï¼Œä¾æ¬¡ç›¸ä¹˜

```python
import sys
data=list(map(int,sys.stdin.readline().split()))
n=data[0]
m_1=data[1]
m_2=data[2]
matrix_a={}
matrix_b={}
for i in range(n):
    matrix_a[i]=[]
    matrix_b[i]=[]
for i in range(m_1):
    data=list(map(int,sys.stdin.readline().split()))
    matrix_a[data[1]].append((data[0],data[2]))
for i in range(m_2):
    data=list(map(int,sys.stdin.readline().split()))
    matrix_b[data[0]].append((data[1],data[2]))
ans=[]
for i in range(n):
    ans.append([0]*n)
for i in range(n):
    for j in matrix_a[i]:
        for k in matrix_b[i]:
            ans[j[0]][k[0]]+=j[1]*k[1]
for i in range(n):
    for j in range(n):
        if ans[i][j]!=0:
            print(' '.join(map(str,[i,j,ans[i][j]])))
```





```python
def getSparseRepresentation(A):
    posList = []
    m = len(A)
    n = len(A[0])
    for i in range(m):
        for j in range(n):
            if A[i][j] != 0:
                posList.append([i,j, A[i][j]])
    return posList

n, m1, m2 = [int(x) for x in input().split()]
A, B = [], []
for i in range(m1):
    A.append([int(x) for x in input().split()])
for i in range(m2):
    B.append([int(x) for x in input().split()])
    
res = [[0 for i in range(n)] for j in range(n)]
for xA, yA, valA in A:
    for xB, yB, valB in B:
        if yA == xB:
            res[xA][yB] += valA * valB
            
res = getSparseRepresentation(res)

for x in res:
    print(x[0], x[1], x[2]) 
```





**æ€è·¯**ï¼šä¸ºäº†é«˜æ•ˆè®¡ç®—ï¼š

- å…ˆæŠŠ Y çš„éé›¶é¡¹æŒ‰è¡Œåˆ†ç»„ï¼š`Y_rows[k] = [(j, val), ...]`
- ç„¶åéå† X çš„æ¯ä¸ªéé›¶é¡¹ `(i, k, valx)`ï¼š
  - å¯¹ Y çš„ç¬¬ k è¡Œçš„æ¯ä¸ª `(j, valy)`ï¼š
    - `Z[i][j] += valx * valy`
- æœ€ååªè¾“å‡ºéé›¶é¡¹ã€‚

```python
n, m1, m2 = map(int, input().split())

X = [tuple(map(int, input().split())) for _ in range(m1)]
Y = [tuple(map(int, input().split())) for _ in range(m2)]

# å°† Y æŒ‰è¡Œåˆ†ç»„ï¼šY_rows[k] = [(col, val), ...]
Y_rows = {}
for r, c, v in Y:
    Y_rows.setdefault(r, []).append((c, v))

# å­˜å‚¨ç»“æœçŸ©é˜µçš„éé›¶é¡¹
res = {}

# éå† X çš„éé›¶é¡¹
for i, k, vx in X:
    if k not in Y_rows:
        continue
    for j, vy in Y_rows[k]:
        res[(i, j)] = res.get((i, j), 0) + vx * vy

# è¿‡æ»¤æ‰å€¼ä¸º 0 çš„ï¼ˆå¯èƒ½ç›¸åŠ åå˜ä¸º 0ï¼‰
items = [(i, j, v) for (i, j), v in res.items() if v != 0]

# æŒ‰è¡Œå·ã€åˆ—å·æ’åºè¾“å‡º
items.sort()

for i, j, v in items:
    print(i, j, v)
```

------

æ—¶é—´å¤æ‚åº¦

- X ä¸­éé›¶é¡¹ï¼šm1ï¼ŒY ä¸­éé›¶é¡¹ï¼šm2
- è‹¥ç¨€ç–æ€§å¥½ï¼Œæ•´ä½“å¤æ‚åº¦çº¦ä¸º O(m1 Ã— å¹³å‡éé›¶åˆ—æ•°)ï¼Œè¿œä¼˜äº O(nÂ³)ã€‚



æ€è·¯æ˜¯ç»å…¸ç¨€ç–çŸ©é˜µä¹˜æ³•å®ç°ï¼š

> åªå¤„ç†éé›¶å…ƒç´ ï¼Œåˆ©ç”¨ä¸­é—´ç´¢å¼• j è¿æ¥ A å’Œ Bï¼Œé€šè¿‡æŒ‰è¡Œå­˜å‚¨ B æ¥å¿«é€ŸæŸ¥æ‰¾ `B[j][k]`

è™½ç„¶ä¹˜æ³•æ¶‰åŠâ€œåˆ—â€ï¼Œä½†å®é™…è®¿é—®æ¨¡å¼è¦æ±‚æˆ‘ä»¬æŒ‰â€œè¡Œâ€ç»„ç»‡ Bï¼Œè¿™æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æ‰€åœ¨ã€‚

```python
from collections import defaultdict

n, m1, m2 = map(int, input().split())

A = defaultdict(list)
for _ in range(m1):
    i, j, v = map(int, input().split())
    A[i].append((j, v))

B = defaultdict(list)
for _ in range(m2):
    i, j, v = map(int, input().split())
    B[i].append((j, v))

C = defaultdict(lambda: defaultdict(int))

for i in A:
    for j, a_val in A[i]:
        if j in B:
            for k, b_val in B[j]:
                C[i][k] += a_val * b_val

result = []
for i in sorted(C.keys()):
    for k in sorted(C[i].keys()):
        if C[i][k] != 0:
            result.append((i, k, C[i][k]))

for r in result:
    print(*r)

```

åˆå§‹åŒ–ç»“æœçŸ©é˜µ C

```python
C = defaultdict(lambda: defaultdict(int))
```

è¿™æ˜¯ä¸€ä¸ª**åµŒå¥—çš„ defaultdict**ï¼š

- `C[i][k]` è¡¨ç¤ºç»“æœçŸ©é˜µ $ C = A \times B $ ä¸­ `(i, k)` ä½ç½®çš„å€¼ã€‚
- å¤–å±‚ï¼š`C[i]` æ˜¯ä¸€ä¸ª defaultdict
- å†…å±‚ï¼šæ¯ä¸ª `C[i][k]` åˆå§‹ä¸º 0ï¼ˆå› ä¸º `lambda: defaultdict(int)`ï¼‰

ğŸ’¡ è¿™æ ·å¯ä»¥ç›´æ¥å†™ `C[i][k] += x`ï¼Œæ— éœ€åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ã€‚





```python
n, m1, m2 = map(int, input().split())

X = []
for _ in range(m1):
    r, c, v = map(int, input().split())
    X.append((r, c, v))

Y = []
for _ in range(m2):
    r, c, v = map(int, input().split())
    Y.append((r, c, v))

Y_by_row = [[] for _ in range(n)]
for r, c, v in Y:
    Y_by_row[r].append((c, v))

result = {}
for rx, cx, vx in X:
    for cy, vy in Y_by_row[cx]:
        result[(rx, cy)] = result.get((rx, cy), 0) + vx * vy

output = []
for (r, c), val in result.items():
    if val != 0:
        output.append((r, c, val))

output.sort()

for r, c, v in output:
    print(r, c, v)
```



æ€è·¯ï¼šdefaultdict,å·¦è¾¹çš„çŸ©é˜µæŒ‰è¡Œå‚¨å­˜ï¼Œå³è¾¹çš„çŸ©é˜µæŒ‰åˆ—å‚¨å­˜

```python
from collections import defaultdict

n, m1, m2 = map(int, input().split())
A = defaultdict(dict)
B = defaultdict(dict)
for _ in range(m1):
    r, c, v = map(int, input().split())
    A[r][c] = v
for _ in range(m2):
    r, c, v = map(int, input().split())
    B[c][r] = v
ans = []
for r in A.keys():
    for c in B.keys():
        cur = 0
        for k in A[r].keys() & B[c].keys():
            cur += A[r][k] * B[c][k]
        if cur != 0:
            ans.append([r, c, cur])
ans.sort()
for l in ans:
    print(*l)
```



æ€è·¯ï¼šæˆ‘ä¸€å¼€å§‹æ²¡çœ‹æ¡ä»¶ï¼Œç”¨è¿˜åŸçŸ©é˜µçš„æ–¹æ³•å…ˆå†™äº†ä¸€éï¼Œacäº†ï¼Œåæ¥å‘ç°æœ‰è¦æ±‚ã€‚é‡æ–°å†™äº†ä¸€ä¸‹ï¼Œå…¶å®åªè¦ææ¸…æ¥šçŸ©é˜µçš„è¿ç®—è§„å¾‹å³å¯ï¼Œåˆ¤æ–­æœ€åå“ªäº›éƒ¨ä½ä¸æ˜¯é›¶å³å¯ã€‚

```python
n,m1,m2=map(int,input().split())

row_a={}
for _ in range(m1):
    i,k,a=map(int,input().split())
    if i not in row_a:
        row_a[i]=[]
    row_a[i].append((k, a))

row_b={}
for _ in range(m2):
    k,j,b=map(int,input().split())
    if k not in row_b:
        row_b[k]=[]
    row_b[k].append((j, b))

result={}
for i in row_a:
    for k,a in row_a[i]:
        if k not in row_b:
            continue
        for j,b in row_b[k]:
            key=(i, j)
            if key in result:
                result[key]+=a * b
            else:
                result[key]=a * b

for (i,j),val in sorted(result.items()):
    print(i,j,val)
```




