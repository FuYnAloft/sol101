# 19959: å€æ•°æ±‚å’Œ

http://cs101.openjudge.cn/practice/19959/

è¾“å…¥ä¸€ä¸ªæ•°æ­£æ•´æ•°n (n <= 10^12),æ±‚å¼å­

<img src="http://media.openjudge.cn/images/upload/1576071661.png" alt="img" style="zoom:50%;" />
çš„å€¼ã€‚ä¹Ÿå°±æ˜¯æ±‚kåœ¨[1,n]å†…çš„æ‰€æœ‰å€æ•°å’Œã€‚

è¾“å…¥

ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ­£æ•´æ•°nï¼Œn<=10^12

è¾“å‡º

è®¡ç®—å¼å­çš„å€¼

æ ·ä¾‹è¾“å…¥

```
Sample1 Input:
9

Sample1 Output:
130

è§£é‡Š: k=1æ—¶,xå–1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9ï¼Œåˆè®¡45ï¼›k=2æ—¶ï¼Œxå–2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œåˆè®¡20ï¼›k=3æ—¶ï¼Œxå–3ï¼Œ6ï¼Œ9ï¼Œåˆè®¡18ï¼›k=4æ—¶ï¼Œxå–4ï¼Œ8ï¼Œåˆè®¡12ï¼›k=5ã€6ã€7ã€8ã€9æ—¶ï¼Œxåˆ†åˆ«å–5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9ï¼Œåˆè®¡35ï¼›å¼å­çš„å€¼å³æ€»å’Œä¸º130
```

æ ·ä¾‹è¾“å‡º

```
Sample2 Input:
15

Sample2 Output:
406

Sample3 Input:
1

Sample3 Output:
1
```

æ¥æº

cs101-2019 å‘¨ç•…



```python
def calculate_sum(n):
    # å¿«é€Ÿè®¡ç®— 1 åˆ° n çš„å’Œ
    def sum_range(x):
        return x * (x + 1) // 2

    # ä¸»è¦é€»è¾‘
    result = sum_range(n)
    k = n // 2
    temp1 = 2

    while k >= 1:
        temp2 = (n // k) + 1
        # å½“å‰èŒƒå›´å’Œ
        range_sum = sum_range(temp2 - 1) - sum_range(temp1 - 1)
        # æ›´æ–°ç»“æœ
        result += range_sum * (k * (k + 1)) // 2
        # æ›´æ–° k å’Œ temp1
        k = n // temp2
        temp1 = temp2

    return result

# è¾“å…¥
n = int(input())
print(calculate_sum(n))
```

> è¯¥è§£æ³•é«˜æ•ˆåœ°è®¡ç®—äº†ä»¥ä¸‹æ•°å­¦è¡¨è¾¾å¼çš„æ€»å’Œï¼š
> $
> S = \sum_{k=1}^{n} \sum_{\text{xæ˜¯kçš„å€æ•°}} x
> $
> å®ƒåˆ©ç”¨äº†æ•°å­¦ä¼˜åŒ–æ–¹æ³•ï¼Œä½¿å¾—æ—¶é—´å¤æ‚åº¦é™è‡³ $ O(\sqrt{n}) $ã€‚
>
> ---
>
> **å…³é”®æ¦‚å¿µ**
>
> 1. **`sum_range(x)` è®¡ç®— 1 åˆ° x çš„å’Œ**
>
>    ```python
>    def sum_range(x):
>        return x * (x + 1) // 2
>    ```
>
>    - è¯¥å‡½æ•°è¿”å›ä» 1 åˆ° \( x \) çš„æ‰€æœ‰æ•´æ•°çš„å’Œï¼Œåˆ©ç”¨äº†æ±‚å’Œå…¬å¼ï¼š
>      $
>      1 + 2 + \dots + x = \frac{x(x+1)}{2}
>      $
>
> 2. **ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ– `result`**
>
>    ```python
>    result = sum_range(n)
>    ```
>
>    - ç”±äºæ‰€æœ‰æ•°ï¼ˆ1 åˆ°  n ï¼‰éƒ½è‡³å°‘è¢« 1 æ•´é™¤ä¸€æ¬¡ï¼Œé¦–å…ˆå°†å…¶æ€»å’ŒåŠ åˆ° `result` ä¸­ï¼š
>      $
>      S = 1 + 2 + \dots + n = \frac{n(n+1)}{2}
>      $
>
> 3. **æ ¸å¿ƒä¼˜åŒ–ï¼šåˆå¹¶è®¡ç®—å¤šä¸ª `k` å€¼çš„è´¡çŒ®**
>
>    ```python
>    k = n // 2
>    temp1 = 2
>    ```
>
>    - `k = n // 2` è¡¨ç¤ºå½“å‰å¤„ç†çš„ `k` å–å€¼ï¼Œåˆå§‹è®¾ä¸º \( n // 2 \)ã€‚
>    - `temp1 = 2` ä½œä¸ºåŒºé—´ä¸‹ç•Œã€‚
>
> ---
>
> **æ ¸å¿ƒå¾ªç¯**
>
> ```python
> while k >= 1:
>     temp2 = (n // k) + 1
> ```
>
> - `temp2` è®¡ç®— `n // k` å˜åŒ–çš„ä¸‹ä¸€æ®µè¾¹ç•Œã€‚
> - å…³é”®æ€æƒ³æ˜¯ï¼šå½“ \( k \) åœ¨ä¸€å®šèŒƒå›´å†…æ—¶ï¼Œ`n // k` çš„å€¼æ˜¯æ’å®šçš„ã€‚
> - ä¾‹å¦‚ï¼Œè‹¥ `n = 9`ï¼š
>   - `k = 1` æ—¶ï¼š`n // 1 = 9`
>   - `k = 2` æ—¶ï¼š`n // 2 = 4`
>   - `k = 3,4` æ—¶ï¼š`n // k = 3`
>   - `k = 5,6,7,8,9` æ—¶ï¼š`n // k = 1`
>   - è¿™äº›å¯ä»¥è¢«åˆ†æ®µå¤„ç†ï¼Œè€Œéå•ç‹¬è®¡ç®—æ¯ä¸ª `k`ã€‚
>
> ---
>
> **è®¡ç®—å½“å‰ `k` å¯¹ `result` çš„è´¡çŒ®**
>
> ```python
> range_sum = sum_range(temp2 - 1) - sum_range(temp1 - 1)
> ```
>
> - `range_sum` è®¡ç®—åŒºé—´ `[temp1, temp2-1]` å†…çš„æ•´æ•°å’Œï¼Œè¡¨ç¤º `k` åœ¨ `[temp1, temp2-1]` å†…çš„æ‰€æœ‰ `x` è´¡çŒ®çš„æ€»å’Œã€‚
> - è®¡ç®—æ–¹å¼ï¼šç”¨ `sum_range(temp2-1)` å‡å» `sum_range(temp1-1)`ï¼Œå³ï¼š
>   $
>   \sum_{x=temp1}^{temp2-1} x = \sum_{x=1}^{temp2-1} x - \sum_{x=1}^{temp1-1} x
>   $
>
> ---
>
> **æ›´æ–° `result`**
>
> ```python
> result += range_sum * (k * (k + 1)) // 2
> ```
>
> - `range_sum` æ˜¯æŸæ®µ `k` èŒƒå›´çš„æ•´æ•°ä¹‹å’Œã€‚
> - `(k * (k + 1)) // 2` æ˜¯ `k` çš„å€æ•°å’Œå…¬å¼ï¼š
>   $
>   k \cdot (1 + 2 + \dots + \lfloor n/k \rfloor) = k \times \frac{\lfloor n/k \rfloor \times (\lfloor n/k \rfloor + 1)}{2}
>   $
> - å°†ä¸¤è€…ç›¸ä¹˜ï¼Œå³å¾—åˆ° `k` åœ¨è¯¥èŒƒå›´å¯¹æœ€ç»ˆ `result` çš„è´¡çŒ®ã€‚
>
> ---
>
> **æ›´æ–° `k` å’Œ `temp1`**
>
> ```python
> k = n // temp2
> temp1 = temp2
> ```
>
> - ç”±äº `temp2` æ˜¯ `n // k + 1`ï¼Œ`k` æ›´æ–°ä¸º `n // temp2`ï¼Œå³ `k` ç›´æ¥è·³åˆ°ä¸‹ä¸€ä¸ªåŒºé—´çš„æœ€å¤§ `k`ã€‚
> - `temp1 = temp2`ï¼Œä¸‹æ¬¡è¿­ä»£æ—¶æ–°çš„ `temp1` ä»£è¡¨å½“å‰åŒºé—´çš„èµ·ç‚¹ã€‚
>
> ---
>
> **æ—¶é—´å¤æ‚åº¦åˆ†æ**
>
> - ç”±äº `k` æ¯æ¬¡æŒ‰ `n // k` å˜åŒ–ï¼Œ`k` å˜åŒ–çš„æ¬¡æ•°å¤§çº¦æ˜¯ `O(âˆšn)`ï¼ˆå› ä¸º `n // k` ä¸»è¦å˜åŒ–åœ¨ `âˆšn` å·¦å³ï¼‰ã€‚
> - å› æ­¤ï¼Œè¯¥è§£æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º **`O(âˆšn)`**ï¼Œè¿œä¼˜äº `O(n)` çš„æœ´ç´ è§£æ³•ã€‚
>
> ---
>
> **ç¤ºä¾‹åˆ†æ**
>
> #### **è¾“å…¥ `n = 9`**
>
> **è®¡ç®—è¿‡ç¨‹**
>
> 1. `sum_range(9) = 45`ï¼Œåˆå§‹åŒ– `result = 45`
> 2. è¿›å…¥å¾ªç¯ï¼š
>    - `k=4, temp1=2`
>    - `temp2=5`ï¼Œè®¡ç®— `[2, 4]` çš„ `range_sum = sum_range(4) - sum_range(1) = 10 - 1 = 9`
>    - è´¡çŒ® `9 Ã— (4Ã—5/2) = 9 Ã— 10 = 90`
>    - æ›´æ–° `result = 45 + 90 = 135`
>    - `k = 9//5 = 1, temp1 = 5`
> 3. ç»§ç»­ï¼š
>    - `temp2 = 10`
>    - `range_sum = sum_range(9) - sum_range(4) = 45 - 10 = 35`
>    - è´¡çŒ® `35 Ã— (1Ã—2/2) = 35 Ã— 1 = 35`
>    - `result = 135 + 35 = 130`
> 4. ç»ˆæ­¢å¾ªç¯ã€‚
>
> æœ€ç»ˆè¾“å‡ºï¼š
>
> ```
> 130
> ```
>
> ---
>
> **æ€»ç»“**
>
> - è¯¥æ–¹æ³•åˆ©ç”¨æ•°å­¦ä¼˜åŒ–ï¼Œè·³è¿‡äº† `O(n)` çš„è®¡ç®—ï¼Œå®ç° `O(âˆšn)` å¤æ‚åº¦ã€‚
> - é€šè¿‡ `sum_range(x)` å¿«é€Ÿæ±‚å’Œï¼Œé¿å…é€ä¸ªéå† `k`ã€‚
> - é€šè¿‡ `temp1` å’Œ `temp2` åˆ†æ®µå¤„ç†ï¼Œç¡®ä¿ `k` åªè®¡ç®—å…³é”®åŒºé—´ã€‚
> - é€‚ç”¨äº `n` æœ€å¤§åˆ° \( 10^{12} \)ï¼Œé«˜æ•ˆä¸”å®ç”¨ã€‚
>
> è¯¥è§£æ³•æ¯”ç›´æ¥æš´åŠ›æ±‚è§£ **å¿«å¾ˆå¤š**ï¼Œæ˜¯ä¸€ä¸ªå·§å¦™çš„æ•°å­¦ä¼˜åŒ–æ–¹æ³•ï¼ ğŸš€



```python
def main():
    import sys
    input_data = sys.stdin.read().strip()
    if not input_data:
        return
    n = int(input_data)
    ans = 0
    k = 1
    # Process intervals where floor(n/k) remains constant.
    while k <= n:
        m = n // k         # For current k, m is floor(n/k)
        r = n // m         # r is the maximum k with the same floor(n/k)
        # Sum of k in the interval [k, r]
        sum_k = (k + r) * (r - k + 1) // 2
        # For each k, the sum of its multiples up to n is k * (1+2+...+floor(n/k))
        # and the inner sum equals m*(m+1)//2.
        ans += sum_k * (m * (m + 1) // 2)
        k = r + 1

    print(ans)

if __name__ == "__main__":
    main()
```

> Explanation
>
> 1. **Understanding the Problem:**
>    - For each integer \( k \) from 1 to \( n \), we need to sum up all multiples of \( k \) that are less than or equal to \( n \).
>    - The multiples of \( k \) are $ k, 2k, 3k, \dots, \lfloor \frac{n}{k} \rfloor \cdot k $.
>    - The sum for a fixed \( k \) is $ k \times \frac{\lfloor \frac{n}{k} \rfloor (\lfloor \frac{n}{k} \rfloor + 1)}{2} $.
>
> 2. **Optimization:**
>    - Since \( n \) can be as large as \( 10^{12} \), iterating from 1 to \( n \) is not feasible.
>    - We optimize by grouping intervals where $ \lfloor \frac{n}{k} \rfloor $ remains constant.
>    - For a given $ m = \lfloor \frac{n}{k} \rfloor $, the value of \( k \) remains constant for \( k \) in the interval \([L, R]\) where $ L = \lfloor \frac{n}{m+1} \rfloor + 1 $ and $ R = \lfloor \frac{n}{m} \rfloor $.
>
> 3. **Algorithm:**
>    - Use a while-loop to process segments of \( k \) where $ \lfloor \frac{n}{k} \rfloor $ is constant.
>    - Compute the sum of \( k \) over each segment using the arithmetic sum formula.
>    - Multiply the segment sum by $ \frac{m(m+1)}{2} $ (the sum of numbers from 1 to  m ).
>    - Add to the final answer and move  k  to the next segment.
>
> 4. **Input/Output:**
>    - The program reads the input number  n  and prints the computed result.
>
> This solution efficiently computes the desired sum even for very large values of  n .


